---
title: 어떤 In-memory Database를 사용할까? (Redis vs Memcached)
modified: 2020-10-30
author: Yo0oN
categories: [Project, festa]
tags: [Project]
math: true
---

<hr>

## 1. Redis와 memcached

Redis(Remote Dictionary Server)와 memcached 둘 모두 Key와 Value를 한 쌍으로 데이터를 저장하는 In-memory Database이다.<br>
둘 모두 In-memory이기 때문에 역시 데이터 처리 속도가 빠르고, 휘발성이다.

## 2. Redis와 memcached의 비교

### Collection 구조
Redis는 기본적으로 Collection 구조를 제공한다.
특징으로는 아래와 같은 것들이 있다.

- Collection 구조를 제공한다.<br>
개발시 편리하고, 개발 시간을 단축할 수 있다는 장점이 있지만, 잘못된 Collection을 사용하면 데이터를 다룰 때 속도에 영향을 줄 수 있으니 주의해서 사용해야 한다.<br>
(하나의 컬렉션에 너무 많은 아이템을 넣으면 조회시 시간이 오래걸리므로 1만개 이하로 유지하는 것이 좋다고 함)

### 장애에 대한 처리
Redis는 장애를 위한 Replication(복제) 기능을 제공한다.<br>
In-memory Database의 경우 메모리 용량이 부족하여 더이상 데이터를 저장하지 못하거나, 장애가 생겨 사라질 수 서버가 중단되는 경우 기존의 데이터가 사라질 수 있다.<br>
Redis는 이를 위해 Master-Slave 기능을 사용할 수 있도록 복제를 지원한다.<br>
Master-Slave는 그림과 같이 Master가 되는 DBMS가 있고, Slave이 되는 DBMS가 따로 존재하는데, Master에 처음 모든 데이터를 저장하고, Slave에 같은 데이터를 복제하여 저장한다.
Master는 읽기, 쓰기가 가능하고, Slave는 데이터만 읽을 수 있는데, 이후 Master에 문제가 생길 경우 Slave는 에러를 발생시키고, Slave가 Master로 변해 서비스를 이어갈 수 있게 된다.<br>
반면, memcached는 복제 기능을 제공하지 않고, Consistent Hashing 알고리즘을 통해 여러 memcached 서버에 데이터를 분산 저장하는 기능을 제공한다. memcached 서버의 수가 늘어날 수록 손실되는 데이터의 수는 줄겠지만 결론적으로 장애가 일어난 곳의 데이터는 사용할 수 없으니 장애를 완전하게 극복하지는 못힌다.<br>
> 물론 이를 대비하여 각 memcached 서버마다 백업 서버를 배치하는 경우도 있다.

### thread
Redis는 싱글 스레드, memcached는 멀티스레드로 작동한다.<br>
싱글 스레드의 경우 결과 값을 보장받을 수 있다는 장점이 있지만, 병목현상이 발생할 수 있다는 단점이 있다.
그렇지만 Redis의 경우 디스크가 아닌 메모리에서 동작하기 때문에 1초당 100만 건의 요청을 처리할 수 있고, 그 덕분에 병목현상이 일어날 일이 적다고 한다.<br>
반대로 memcached의 경우 멀티스레드이기 때문에 값을 보장받지 못하나? 라고 생각할 수 있으나, 명령어를 받는 부분까지는 멀티 스레드로 수행하지만, 데이터에 접근하는 경우에는 싱글 스레드처럼 동작한다.

Redis에는 여러 장점도 있지만, 반대로 단점도 있다.

### 메모리 관리
Redis는 메모리가 다 차면, 이후 디스크에도 데이터를 저장하게 되는데, 디스크에 저장된 데이터에 접근할 때는 Swap이 일어난다. 한번 Swap이 일어난 페이지는 이후에도 계속 Swap이 일어나기 때문에 오히려 속도가 더 느려진다.<br>
Swap이 없다면 메모리가 꽉 차서 더이상 사용할 수 없게 된다.<br>
> Swap : 메모리가 부족할 때 메모리의 내용을 디스크에 저장한 후 필요시 디스크에 접근하여 다시 메모리로 끌어올리는 작업. 디스크와 메모리간의 교환


### 응답 속도


**참고**
- 


**관련 프로젝트**
- [event-recommender-festa](https://github.com/f-lab-edu/event-recommender-festa) (2020-09 ~)

