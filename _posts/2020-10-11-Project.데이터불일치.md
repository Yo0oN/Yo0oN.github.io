---
title: Project 01. Scale-out에서 데이터 불일치를 해결하는 방법
modified: 2020-10-11
author: Yo0oN
categories: [Project]
tags: [Project]
math: true
---

- 이전 글 : [대용량 트래픽을 해결하는 방법](_post/2020-10-11-Project.대용량트래픽.md)
- 관련 프로젝트 : [event-recommender-festa](https://github.com/f-lab-edu/event-recommender-festa) (2020-09 ~)

<hr>

## 1. 데이터 불일치를 해결하는 방법

대용량 트래픽이 발생할 경우 Scale-out 방식으로 서버를 늘려 프로젝트를 진행하기로 하였다.

하지만 Scale-out의 경우 서버가 여러대이기 때문에 서버 간 데이터가 일치하지 않는 현상을 처리해야 한다.<br>
대표적으로 로그인을 예시로 들어보자면, 로그인 시 Session을 생성하여 서버에 저장하고, 해당 세션을 이용하여 사용자가 로그인 상태임을 알 수 있다.<br>
그런데 서버가 여러개인 경우 로그인했던 서버가 아닌 다른 서버로 다시 요청을 하면 다른 서버에는 Session이 없기 때문에 로그인 상태에서 벗어나버린다.

이 때 사용하는 방법이 ***Sticky Session***과 ***Session Clustering***, ***In-MemoryDB***를 사용하는 방법이 있다.<br>

## 2. Sticky Session

Sticky Session은 처음 요청을 보냈을 때 응답을 준 서버로만 계속 요청을 보내, 특정 서버에 붙어있는 방식이다.

![StickySession](/images/posts/Project/event-recommender-festa/대용량트래픽/StickySession01.jpg)

그림에서 보듯 첫번째 요청은 계속 첫번째 서버로만, 두번째 요청은 두번째 서버로만 전달되며, 가운데에서 분배해주는 일을 하는 것을 **Load Balancer**라고 부른다.<br>
Load Balancer는 요청한 브라우저의 쿠키를 확인하여 해당 쿠키에 해당하는 서버로, 쿠키가 없다면 새로운 쿠키를 생성한 후 서버로 보내준다.

특정 서버로만 요청을 하기 때문에 세션이 그대로 있어 데이터 불일치 문제를 해결할 수 있으나, 단점도 있다.<br>
만약 서버 하나로만 많은 요청이 몰릴 수 있다는 것과, 자신의 세션이 없는 다른 서버는 사용할 수 없다는 것이다.<br>
또, 하나의 서버가 사용할 수 없게 되는 상황이 오면 해당 서버에 있는 세션들을 모두 사용할 수 없다.

## 3. Session Clustering

Session Clustering은 여러 서버가 하나처럼 작동하도록 하는 기술이다.<br>
여러 WAS들이 있는 경우 하나의 WAS처럼 묶어서 사용한다.

Sticky Session과는 다르게 여러 서버를 하나로 묶어 사용하기 때문에 서버가 하나 종료된다고 하더라도, 다른 서버들이 있어 문제가 생기지 않는다.<br>
대신, 모든 서버에 같은 내용의 세션이 있어야 하기 때문에 메모리가 많이 필요하다는 단점과 서버 수가 너무 많으면 반대로 성능이 떨어질 수 있다는 단점이 있다.

여러 서버를 하나로 묶어 사용하는 방법은 여러가지가 있는데, 사용하는 WAS에 따라 다른 방법이 적용된다.


